jQuery((function(e){const n="#wc-"+onvo_pay_params.id+"-cc-form";if(0===e(n).length)return;if(!onvo)throw ReferenceError("Onvo SDK not enqueued");const o=".woocommerce",r="#order_review",t="#place_order",a=/^#([0-9a-f]{3}){1,2}$/i,d=["PAYMENT_FAILED","PAYMENT_TIMEOUT","TERMS_MODAL_OPENED","MOBILE_MODAL_PAYMENT_OPENED","PAYMENT_REQUIRES_ACTION"],c=["PAYMENT_IN_PROGRESS","PAYMENT_ACTION_COMPLETED"],i=["PAYMENT_FORM_VALID"];let s=!1;function u(){s=!0}function m(){s=!1}const l={isSelected:function(){return e("form.checkout").find('input[name="payment_method"]:checked').val()===onvo_pay_params.id},createElements:function(){"yes"===onvo_pay_params.isCheckout&&l.renderWidget()},showSpinner:function(){const{spinnerOpacity:n,spinnerBackground:t}=onvo_pay_params,d=(c=parseFloat(n))>=0&&c<=1?parseFloat(n):.6;var c;const i=a.test(t)?t:"#000";e(o).block({message:null,overlayCSS:{background:i,opacity:d}}),e(r).block({message:null,overlayCSS:{background:i,opacity:d}})},hideSpinner:function(){e(o).unblock(),e(r).unblock()},disablePlaceOrderButton:function(){e(t).prop("disabled",!0).addClass("disabled processing")},enablePlaceOrderButton:function(){e(t).prop("disabled",!1).removeClass("disabled processing")},bodyOnClickPlaceOrderHandler:function(e){l.savePayDataForm(onvo_pay_params.paymentIntentId),l.submitCheckoutForm()},maybeSubmitOnvoPayment:function(e,n){(function(e){if(!e.length)return!0;const n='<div role="alert"></div>';return e.trim()===n||!!Array.isArray(e)&&0===(e=e.filter((function(e){return e.trim()!==n}))).length})(n)&&(document.querySelector("#onvo_method_id").value||s||(e.stopImmediatePropagation(),l.disablePlaceOrderButton(),l.showSpinner(),u(),l.sdkInstance.submitPayment()))},bodyOnSubmitOrderReviewHandler:function(e){l.showSpinner(),l.disablePlaceOrderButton(),document.querySelector("#onvo_method_id").value||s||(e.stopImmediatePropagation(),l.sdkInstance.submitPayment(),u())},bodyOnPaymentMethodSelectedHandler:function(e){l.isSelected()?(l.createElements(),l.addListeners()):(l.removeListeners(),l.enablePlaceOrderButton(),l.hideSpinner(),m())},addListeners:function(){"yes"===onvo_pay_params.isCheckout&&onvo_pay_params.needsPayment&&(e(document.body).on("click","#place_order",l.bodyOnClickPlaceOrderHandler),e(document.body).on("checkout_error",l.enablePlaceOrderButton),e(document.body).on("checkout_error",l.maybeSubmitOnvoPayment),e(document.body).on("submit","#order_review",l.bodyOnSubmitOrderReviewHandler))},removeListeners:function(){e(document.body).off("click","#place_order",l.bodyOnClickPlaceOrderHandler),e(document.body).off("checkout_error",l.enablePlaceOrderButton),e(document.body).off("submit","#order_review",l.bodyOnSubmitOrderReviewHandler)},sdkInstance:null,renderWidget:function(){if(document.querySelector(n+" iframe"))return;const e=l.getSdkParams();if(!e.paymentType)return;const o={onError:e=>{console.error("onError",e),l.savePayDataForm(onvo_pay_params.paymentIntentId,null,e?.lastPaymentError?.message||e.message),l.submitCheckoutForm(),setTimeout((()=>{l.hideSpinner(),m()}),1e3)},onSuccess:e=>{console.info("onSuccess",e),l.savePayDataForm(e.id,e.paymentMethodId),l.submitCheckoutForm(),l.hideSpinner(),m()},onFormErrors:()=>{l.hideSpinner(),m()},onShopperTrail:e=>{d.includes(e)&&l.hideSpinner(),c.includes(e)&&l.showSpinner(),i.includes(e)&&l.enablePlaceOrderButton()},manualSubmit:!0,branding:!1,...e},r=onvo.pay(o);r.render(n),l.sdkInstance=r},getSdkParams:function(){const e={debug:"1"===onvo_pay_params.debug,shopper:onvo_pay_params.shopper||{}};return onvo_pay_params.publishableKey&&(e.publicKey=onvo_pay_params.publishableKey),onvo_pay_params.paymentIntentId&&(e.paymentIntentId=onvo_pay_params.paymentIntentId,e.paymentType="one_time",l.savePayDataForm(e.paymentIntentId)),onvo_pay_params.customerId&&(e.customerId=onvo_pay_params.customerId),e},savePayDataForm:function(e,n=null,o=null){const r=document.querySelector("#onvo_error_msg"),t=document.querySelector("#onvo_method_id");document.querySelector("#onvo_intent_id").value=e,t.value=n,r.value=o},submitCheckoutForm(){e(".woocommerce-checkout, #order_review").trigger("submit")},init:function(){e(document.body).on("payment_method_selected updated_checkout init_checkout",l.bodyOnPaymentMethodSelectedHandler)}};l.init()}));